

 <!DOCTYPE html>
<html>
<head>
    <title>leaflet-sidebar example</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
    <link rel="stylesheet" href="css/L.Control.Sidebar.css" />
    <!--[if lte IE 8]><link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.ie.css" /><![endif]-->

    <style>
        body {
            padding: 0;
            margin: 0;
        }
        html, body, #map {
            height: 100%;
        }
        .lorem {
            font-style: italic;
            color: #AAA;
        }
    </style>
</head>
<body>
    <div id="sidebar-left">
        <h1>left sidebar</h1>
    </div>
    <div id="sidebar-right">
        <h1>right sidebar</h1>
    </div>

    <div id="map"></div>

    <a href="https://github.com/Turbo87/leaflet-sidebar/"><img style="position: fixed; top: 0; right: 0; border: 0; z-index: 3000" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>

    <script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>
    <script src="js/L.Control.Sidebar.js"></script>




    <script>
        var map = L.map('map');
        map.setView([51.2, 7], 9);
        L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: 'Map data &copy; OpenStreetMap contributors'
        }).addTo(map);
       
        var leftSidebar = L.control.sidebar('sidebar-left', {
            position: 'left'
        });
        map.addControl(leftSidebar);
        var rightSidebar = L.control.sidebar('sidebar-right', {
            position: 'right'
        });
      
    </script>


    <script>










        //Add the map to the page with all the features note zoom control is used here which adds a zoom icon however below L.control.zoom can be used and add more detailed functionality  
   







    L.control.zoom({
       position:'topright'
    }).addTo(map);





//add geolocation on click button
//ref https://stackoverflow.com/questions/3397585/navigator-geolocation-getcurrentposition-sometimes-works-sometimes-doesnt#3885172
    function geolocation(){ 
       if (navigator.geolocation) {

    var location_timeout = setTimeout("geolocFail()", 10000);


    navigator.geolocation.getCurrentPosition(function(position) {
          
        //clearTimeout(location_timeout);

        var lat = position.coords.latitude;
        var lng = position.coords.longitude;
        map.setView([lat, lng], 10);
        //could add a marker here to show persons current location
        

        geocodeLatLng(lat + " " +  lng);

    }, function(error) {
        clearTimeout(location_timeout);
        geolocFail();
    });
} else {
    // Fallback for no geolocation
    geolocFail();
}
}


//This functionality removes the elements that are clicked on in the top of the side bar. This code needs to be in the body tag or it will throw a error
//This code works by overwriting the leaflet library functionality firstly setting the leafletView.Cluster._markers = [] as empty. It then makes calls to the different groups sql calls 
//as seen with the group names e.g. DTAS these functions are below 
    var commLandCount;
    var DTAScount = 0;


  function removeElements(group){


    //if button css is clicked dont call it else call it for every one  
    //1st Job - work out how to distinguish the css functionality
    //give it a marker of some kind 




   
    var property = document.getElementsByClassName("commLandButton");
    console.log(property);

    if(num == 0){
    //var property = document.getElementByClass(tablinks1);
    var property = document.getElementsByClassName("commLandButton");
    $(property).css({"background-color":"black"});
    //DTAS();
    //ECS();
    

    //map.setView([55.3781, -4.4361], 7);
    //map.setView([55.3781, -4.4361], 6);
    
    $('commLandButton').attr('id', '1');
    }else{
      var property = document.getElementsByClassName("commLandButton");
      $(property).css({"background-color":"red"});
      $('commLandButton').attr('id', '0');
      
    }


/*     if(group == DTAS) {
    DTAS(); 
    ECS();

    map.setView([55.3781, -4.4361], 7);
    map.setView([55.3781, -4.4361], 6);
    }else if(group == ECS){
    DTAS();
    commLand(); 
  

    }else{
    DTAS();
    commLand(); 


    map.setView([55.3781, -4.4361], 7);
    map.setView([55.3781, -4.4361], 6);

    

    
    }
*/    leafletView.ProcessView();
    //console.log(leafletView.Cluster._markers);
          }  




//This will be the functionality to select the nearest location in relation to the point selected
//Make call within div above and then sql gets execueed and displays the results which will be clickable 
//Have to access the elements with something like KNN.get1() etc
//This adds the data to the side bar which is just a set up but needs to be dynamic so on click it will update the opnSideBar function and pass params 

//need to send data here but not going


//popUp would not send the data from the onlcick  function so had to call the data again within popUp method
//The param is a reference to the group reference in the data1 array which will be used within this function
//It would not accept the sql data so there is a seconfd sql call possibly too large a data set within this method to fetch the data
//It resets the sidebar and zoom to match the KNN point clicked in the KNN function below 
 function popUp(num1){
    

     var query4 = $.getJSON('https://carto.mapping.community:9090/user/hilld/api/v2/sql?format=GeoJSON&q=SELECT * FROM "mapcomm-admin".communityland_groups_gb_sct',     
    function(data1) {
    
   

     //call side bar
    //(network, ID,url,facebook_url,twitter_url,description)
    var network = data1.features[num1].properties.network;
    var ID = data1.features[num1].properties.name;
   // alert(ID);
    var url = data1.features[num1].properties.url;
    var facebook_url = data1.features[num1].properties.facebook_url;
    var twitter_url = data1.features[num1].properties.twitter_url;
    var url = data1.features[num1].properties.url;
    var description = data1.features[num1].properties.description;

    openSidebar(network, ID,url,facebook_url,twitter_url,description);
    
    var long = data1.features[num1].geometry.coordinates[0];
    var lat = data1.features[num1].geometry.coordinates[1];
    map.setView([lat,long ], 11);
   

     });

    



//opensidenetwork, ID,url,facebook_url,twitter_url,description

    //console.log("data what" + lat.features[0].properties.name);
    // //openSidebar(network, ID,url,facebook_url,twitter_url,description);
    //    openSidebar(data.feature.properties.network, data.feature.properties.name, data.feature.properties.url,data.feature.properties.facebook_url,data.feature.properties.twitter_url,data.feature.properties.description);
     
  //KNN is a function which will display the 4 nearest neighbours for the currently selected point which is called from the OpensideBar function below  updates the KNN sidebar section and then has functionality to on click the buttons calls the popUp function above 

  };


  function KNN(num1,num2){
    //alert(num1);
    var divToAddContent1 = document.getElementById('tabKNN');
    


 var query4 = $.getJSON('https://carto.mapping.community:9090/user/hilld/api/v2/sql?format=GeoJSON&q=SELECT * FROM "mapcomm-admin".communityland_groups_gb_sct',     
    function(data1) {
      //console.log(data1.features[0].properties.name,data1.features[1].properties);
      var data = data1;

      console.log("data")
      console.log( data);
      var name = data1.features[0].properties.name;

      //This needs updating so there is an icon next to the name which is clickable and it calls another function that will zoom to the point given co-ords on the map
    

   

       divToAddContent1.innerHTML =  
       
         '<button class="tablinks3" onclick="popUp('+ num1 + ')"> '+ data1.features[num1].properties.name + '  </button>'
         +
         '<button class="tablinks3" onclick="popUp('+ num2+ ')"> '+ data1.features[num2].properties.name + '  </button>'

         +
         '<button class="tablinks3" onclick="popUp('+ num1 + ')"> '+ data1.features[num1].properties.name + '  </button>'
         +
         '<button class="tablinks3" onclick="popUp('+ num2+ ')"> '+ data1.features[num2].properties.name + '  </button>'
         ;
    });

//four NN removed
//+ data1.features[0].properties.name + data1.features[1].properties.name

  };

  

   

 

 


    function openSidebar(network, ID,url,facebook_url,twitter_url,description) {   

   
            



        
            
            //This adds a parser funcionality if the input from the database contains errors needed to change the url formatting if incorrect in the database
            var parser = document.createElement('a');
            parser.href = url;
            parser.protocol; // => "http:"
            parser.hostname; // => "example.com"
            parser.port;     // => "3000"
            parser.pathname; // => "/pathname/"
            parser.search;   // => "?search=test"
            parser.hash;     // => "#hash"
            parser.host; // => "example.com:3000"

            //This is functionality for entries that are incorrect which alters the url so that it becomes a link and adds https://
            if(url != null && parser.protocol != "http://" && network == "Community Land Scotland"){
              //alert(network);
              url = "http://" + url;
              //alert(url)
            }


            //This is to format the length of the text in the sidebar
            if(url == null){
              url1 = "";
            } else if (url.length > 20){
                //parse and remove 
               
                url1 = parser.hostname;
                
            } else{
                url1 = parser.host;
            }



             if(twitter_url == undefined){
                   
                sidebar.open('home');
              var divToAddContent = document.getElementById('home');
              
              //This information is what is displayed in the pop out.
               divToAddContent.innerHTML = "<b>" + network + "</b>" + "</br></br>" + "<b>Name: </b>" + ID + "</br>" + "<b>Url: </b>" +
              '<a href="'+ url + '" target="_blank"' + '>' + url1 + '</a>' + "</br><b>Description:</b> " + description
              +"</br></br></br></br>"+  "<b>"+ "KNN placement" + "</b>";
            }
            else if(url == undefined || url == null || url == ""){



              sidebar.open('home');
              var divToAddContent = document.getElementById('home');
              
              //This information is what is displayed in the pop out.
              divToAddContent.innerHTML = "<b>" + network + "</b>" + "</br></br>" + "<b>Name: </b>" + ID +  "</br><b> Facebook: </b>" + facebook_url+ "</br><b>Description:</b> " + description
              +"</br></br></br></br>"+ "<b>"+ "KNN placement" + "</b>" + "</br>";

            //(twitter_url == null){
               
              
            }else if (facebook_url == undefined){

                   sidebar.open('home');
              var divToAddContent = document.getElementById('home');
              
              //This information is what is displayed in the pop out.
                divToAddContent.innerHTML = "<b>" + network + "</b>" + "</br></br>" + "<b>Name: </b>" + ID + "</br>" + "</br><b>Description:</b> " + description
              +"</br></br></br></br>"+ "<b>"+ "KNN placement" + "</b>" + "</br>";
            }

            //This removes previous text upon updating the side bar
              if ($('#sidebar-text').text().length > 0) {
                  $("#sidebar-text").removeText();
                  $("#sidebar-text2").removeText();

                 

                  

              }

          // $("#tabKNN").removeText();
          // KNN(Math.floor (Math.random()*10),Math.floor (Math.random()*10));
          KNN(0,1);


           




              //This will remove the elements of the selected button type
              
              /* for(var i = 0, markers.length ; i++){
                console.log(markers);

              }
             */

             

              /*for (var i = 0, len = results.length; i < len; i++) {
                   
               //this loop matches the array element to the passed ID  
                  if (results[i].Link == ID) {
                      thisResult = (results[i]);            
                  }
              }
              */
              //remove name from thisResult and others
            
          }


          //Adds the prune cluster view for leaflet so other items can be added to it. Refer to prune cluster docs for more info
          //Find prunecluster docs at https://github.com/SINTEF-9012/PruneCluster
          //This is boilerplate code taken from the examples on the prunecluster library
    var leafletView = new PruneClusterForLeaflet();

    


    //Adds prune cluster functionality for the page
    leafletView.BuildLeafletClusterIcon = function(cluster) {
        var e = new L.Icon.MarkerCluster();

        e.stats = cluster.stats;
        e.population = cluster.population;
        return e;
    };

    // Define colours for markercluster ring segments
    var colors = ['#ff4b00', '#bac900', '#EC1813', '#55BCBE', '#D2204C', '#FF0000', '#ada59a', '#3e647e'],
        pi2 = Math.PI * 2;

    L.Icon.MarkerCluster = L.Icon.extend({
        options: {
            //This had an error as it was trowing off the marker alignment so had to be reduced
            iconSize: new L.Point(80, 50),
            // iconSize:     [38, 95], // size of the icon
            //className: 'prunecluster leaflet-markercluster-icon'
        },

        createIcon: function () {
            // based on L.Icon.Canvas from shramov/leaflet-plugins (BSD licence)
            var e = document.createElement('canvas');
            this._setIconStyles(e, 'icon');
            var s = this.options.iconSize;
            e.width = s.x;
            e.height = s.y;
            this.draw(e.getContext('2d'), s.x, s.y);
            return e;
        },

        createShadow: function () {
            return null;
        },

        draw: function(canvas, width, height) {

            var lol = 0;

            var start = 0;
            for (var i = 0, l = colors.length; i < l; ++i) {

                var size = this.stats[i] / this.population;


                if (size > 0) {
                    canvas.beginPath();
                    canvas.moveTo(22, 22);
                    canvas.fillStyle = colors[i];
                    var from = start + 0.14,
                        to = start + size * pi2;

                    if (to < from) {
                        from = start;
                    }
                    canvas.arc(22,22,22, from, to);

                    start = start + size*pi2;
                    canvas.lineTo(22,22);
                    canvas.fill();
                    canvas.closePath();
                }

            }

            canvas.beginPath();
            canvas.fillStyle = 'white';
            canvas.arc(22, 22, 18, 0, Math.PI*2);
            canvas.fill();
            canvas.closePath();

            canvas.fillStyle = '#555';
            canvas.textAlign = 'center';
            canvas.textBaseline = 'middle';
            canvas.font = 'bold 12px sans-serif';

            canvas.fillText(this.population, 22, 22, 40);
        }
    });



    var size = 10000;
    var markers = [];


    //These are the additional datasets which will be added to the prune clustering, the marker.category needs to be altered along with the marker name/number to prevent duplicates 
    //The getJSON call is used which requires specific url for your carto account ad then a specific sql call check the sql table name on carto as it may not be the same name as you uploaded from your original machine eg "mapcomm-admin".communityenergy_groups_gb_sct' was originally communityenergy_groups_gb_sct. Also, check the port number is correct.


/**
//1st call - community energy
     var query3 = $.getJSON('https://carto.mapping.community:9090/user/hilld/api/v2/sql?format=GeoJSON&q=SELECT * FROM "mapcomm-admin".communityenergy_groups_gb_sct',     
    function(data1) {
             L.geoJSON(data1, {
                  pointToLayer: function (feature, latlng, properties) {
                    //console.log(latlng.lat, latlng.lng);


                     var marker = new PruneCluster.Marker(latlng.lat, latlng.lng, {color: '#000', feature, 
                        'color': '#f3ff00', 'colorClass': 'yellow', 'visible':true,  icon: L.icon({
                iconUrl: 'leaflet.jpeg',
                iconSize: [48, 48]

                 })
                    });
                   
                      
                    marker.category = 0;
                   // marker.category = Math.floor(Math.random() * colors.length);
                    markers.push(marker);
                    leafletView.RegisterMarker(marker);    
}
                  })

});
**/

//2nd call - community land 
function commLand(){

 var query4 = $.getJSON('https://carto.mapping.community:9090/user/hilld/api/v2/sql?format=GeoJSON&q=SELECT * FROM "mapcomm-admin".communityland_groups_gb_sct',     
    function(data1) {
        //console.log(data1);
        L.geoJSON(data1, {
                  pointToLayer: function (feature, latlng, properties) {
                    //console.log(latlng.lat, latlng.lng);
                    var marker1 = new PruneCluster.Marker(latlng.lat, latlng.lng, {color: '#000', feature, 
                        'color': '#f3ff00', 'colorClass': 'yellow', 'visible':true,  icon: L.icon({
                iconUrl: 'leaflet.jpeg',
                iconSize: [48, 48]

                 })
                    });

                    marker1.category = 1;
                   // marker.category = Math.floor(Math.random() * colors.length);
                    markers.push(marker1);
                    leafletView.RegisterMarker(marker1);  
}

})
                  }
          

);
};
commLand(); 


  


    //3rd call - dtas

    function DTAS(){
  var query3 = $.getJSON('https://carto.mapping.community:9090/user/hilld/api/v2/sql?format=GeoJSON&q=SELECT * FROM "mapcomm-admin".dtas_groups_gb_sct',     
    function(data1) {
        
        L.geoJSON(data1, {
                  pointToLayer: function (feature, latlng, properties) {


                    var marker2 = new PruneCluster.Marker(latlng.lat, latlng.lng, {color: '#000', feature, 
                        'color': '#f3ff00', 'colorClass': 'yellow', 'visible':true,  icon: L.icon({
                iconUrl: 'layer.png',
                iconSize: [48, 48]

            })
                    });

                 
                    marker2.category = 2;                    
                   // marker.category = Math.floor(Math.random() * colors.length);
                    markers.push(marker2);
                    leafletView.RegisterMarker(marker2); 

    }
                      })

    });
  }   
  DTAS();

 //4th - ecs
function ECS(){
 var query3 = $.getJSON('https://carto.mapping.community:9090/user/hilld/api/v2/sql?format=GeoJSON&q=SELECT * FROM "mapcomm-admin".ecs_groups_gb_sct',     
    function(data1) {
        
        L.geoJSON(data1, {
                  pointToLayer: function (feature, latlng, properties) {


                    var marker3 = new PruneCluster.Marker(latlng.lat, latlng.lng, {color: '#000', feature, 
                        'color': '#f3ff00', 'colorClass': 'yellow', 'visible':true,  icon: L.icon({
                iconUrl: 'layer.png',
                iconSize: [48, 48]

            })
                    });

                 
                    marker3.category = 3;                    
                   // marker.category = Math.floor(Math.random() * colors.length);
                    markers.push(marker3);
                    leafletView.RegisterMarker(marker3); 

    }
                      })

    }); 
}
ECS();

/*
//4th - city farms
 var query3 = $.getJSON(('https://carto.mapping.community:9090/user/hilld/api/v2/sql?format=GeoJSON&q=SELECT * FROM "mapcomm-admin".cityfarmsgardens_groups_gb_sct',     
    function(data1) {
        
        L.geoJSON(data1, {
                  pointToLayer: function (feature, latlng, properties) {


                    var marker4 = new PruneCluster.Marker(latlng.lat, latlng.lng, {color: '#000', feature, 
                        'color': '#f3ff00', 'colorClass': 'yellow', 'visible':true,  icon: L.icon({
                iconUrl: 'layer.png',
                iconSize: [48, 48]

            })
                    });

                 
                    marker4.category = 4;                    
                   // marker.category = Math.floor(Math.random() * colors.length);
                    markers.push(marker4);
                    leafletView.RegisterMarker(marker4); 

    }
                      })

    }));         


//error? - geojson?
 //7th - comm land
 var query3 = $.getJSON('https://carto.mapping.community:9090/user/hilld/api/v2/sql?format=GeoJSON&q=SELECT * FROM "mapcomm-admin".communityland_groups_gb_sct',     
    function(data1) {
        
        L.geoJSON(data1, {
                  pointToLayer: function (feature, latlng, properties) {


                    var marker5 = new PruneCluster.Marker(latlng.lat, latlng.lng, {color: '#000', feature, 
                        'color': '#f3ff00', 'colorClass': 'yellow', 'visible':true,  icon: L.icon({
                iconUrl: 'layer.png',
                iconSize: [48, 48]

            })
                    });

                 
                    marker5.category = 5;                    
                   // marker.category = Math.floor(Math.random() * colors.length);
                    markers.push(marker5);
                    leafletView.RegisterMarker(marker5); 

    }
                      })

    });         


 


 //6th - sccan
 var query3 = $.getJSON(('https://carto.mapping.community:9090/user/hilld/api/v2/sql?format=GeoJSON&q=SELECT * FROM "mapcomm-admin".sccan_groups_gb_sct',     
    function(data1) {
        
        L.geoJSON(data1, {
                  pointToLayer: function (feature, latlng, properties) {


                    var marker6 = new PruneCluster.Marker(latlng.lat, latlng.lng, {color: '#000', feature, 
                        'color': '#f3ff00', 'colorClass': 'yellow', 'visible':true,  icon: L.icon({
                iconUrl: 'layer.png',
                iconSize: [48, 48]

            })
                    });

                 
                    marker6.category = 6;                    
                   // marker.category = Math.floor(Math.random() * colors.length);
                    markers.push(marker6);
                    leafletView.RegisterMarker(marker6); 

    }
                      })

    }));        


 //7th - permaculture
 var query3 = $.getJSON(('https://carto.mapping.community:9090/user/hilld/api/v2/sql?format=GeoJSON&q=SELECT * FROM "mapcomm-admin".permaculture_groups_gb_sct',     
    function(data1) {
        
        L.geoJSON(data1, {
                  pointToLayer: function (feature, latlng, properties) {


                    var marker7 = new PruneCluster.Marker(latlng.lat, latlng.lng, {color: '#000', feature, 
                        'color': '#f3ff00', 'colorClass': 'yellow', 'visible':true,  icon: L.icon({
                iconUrl: 'layer.png',
                iconSize: [48, 48]

            })
                    });

                 
                    marker7.category = 7;                    
                   // marker.category = Math.floor(Math.random() * colors.length);
                    markers.push(marker7);
                    leafletView.RegisterMarker(marker7); 

    }
                      })

    }));        
*/

  //An attemp to change the icons this is work in progress
      var  myIcon =           L.icon({
        iconUrl: 'leaflet.jpeg',
        iconSize: [38, 95],
        iconAnchor: [22, 94],
        popupAnchor: [-3, -76],
       
        shadowSize: [68, 95],
        shadowAnchor: [22, 94]
    });

      var  myIcon2 =           L.icon({
                         iconUrl: 'leaflet.jpeg',
        iconSize: [10, 25],
        iconAnchor: [22, 94],
        popupAnchor: [-3, -76],
       
        shadowSize: [68, 95],
        shadowAnchor: [22, 94]
                  });




//This section adds functionality to the cluster group which has an onhover(moueover), also an on click functionality
//These need to be added to the leaflet view 
leafletView.PrepareLeafletMarker = function(leafletMarker, data,properties) {

//change the icon for markers error in this 
 /*var iconUrl = layer.png;

 LeafletMarker.setIcon(L.icon({
    iconUrl: iconUrl,
    iconSize: [38, 95],
    iconAnchor: [22, 94],
    popupAnchor: [-3, -76],
    //shadowUrl: 'my-icon-shadow.png',
    shadowSize: [68, 95],
    shadowAnchor: [22, 94]
}));*/
    
       // leafletMarker.setIcon(myIcon2);
   

       // leafletMarker.setIcon(myIcon2);
    
        
         leafletMarker.on('mouseover', function(e) {

          

         


            var popup = L.popup()

            .setLatLng(e.latlng) 
            .setContent( "<b>" + data.feature.properties.name + "</b>" + "</br>" + "</br>"  + "<i>Click for more information<i>")
            .openOn(map);
        });


//This is the mouse out function which has a timer added to delay it by half a second as it was buggy without this functionality and the pop up would flash and not display correctly   
    leafletMarker.on('mouseout', function (e) {

    var delayMillis = 500; //0.5 second
       setTimeout(function() {
            map.closePopup();
          }, delayMillis);        
        });



    leafletMarker.on('click', function(){
        console.log(data);
        
       console.log(data.feature.properties.network)
       openSidebar(data.feature.properties.network, data.feature.properties.name, data.feature.properties.url,data.feature.properties.facebook_url,data.feature.properties.twitter_url,data.feature.properties.description);
     
    //do click event logic here
    })

     

};

    map.addLayer(leafletView);
   console.log("here");
   // console.log(leafletView.Cluster._markers);

  










//This is an implementation of adding layers with mapbox API
/*
    //This is work in progress which is for the additional layers of the areas of deprivation in the uk using  amap box overlay 
    //This is work in progress
    //add the key token from mapbox 
   
    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZGFuaGlsbGNvZGUiLCJhIjoiY2o0dmR3aG1lMG05djMzbzE2dW42OHZkNSJ9.FC7U0-Wz5UBLBu45_w9c_w', {
        maxZoom: 18,
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
            '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
            'Imagery © <a href="http://mapbox.com">Mapbox</a>',
        id: 'mapbox.streets'
    }).addTo(map);


    // control that shows state info on hover
    var info = L.control();


//L.geoJson('us-states.js').addTo(map);


    info.onAdd = function (map) {
        this._div = L.DomUtil.create('div', 'info');
        this.update();
        return this._div;
    };

    info.update = function (props) {
        this._div.innerHTML = '<h4>US Population Density</h4>' +  (props ?
            '<b>' + props.name + '</b><br />' + props.density + ' people / mi<sup>2</sup>'
            : 'Hover over a state');
    };

    info.addTo(map);




    // get color depending on population density value
    function getColor(d) {
        return d > 1000 ? '#800026' :
                d > 500  ? '#BD0026' :
                d > 200  ? '#E31A1C' :
                d > 100  ? '#FC4E2A' :
                d > 50   ? '#FD8D3C' :
                d > 20   ? '#FEB24C' :
                d > 10   ? '#FED976' :
                            '#FFEDA0';
    }

    function style(feature) {
        return {
            weight: 2,
            opacity: 1,
            color: 'white',
            dashArray: '3',
            fillOpacity: 0.4,
            fillColor: getColor(feature.properties.density)
        };
    }

    function highlightFeature(e) {
        var layer = e.target;

        layer.setStyle({
            weight: 5,
            color: '#000',
            dashArray: '',
            fillOpacity: 0.7
        });

        if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
            layer.bringToFront();
        }

        info.update(layer.feature.properties);
    }

    var geojson;

    function resetHighlight(e) {
        geojson.resetStyle(e.target);
        info.update();
    }

    function zoomToFeature(e) {
        map.fitBounds(e.target.getBounds());
    }

    function onEachFeature(feature, layer) {
        layer.on({
            mouseover: highlightFeature,
            mouseout: resetHighlight,
            click: zoomToFeature
        });
    }

    //This is the input of the data for the layer and states data is in the javascript file us-states

    geojson = L.geoJson(statesData, {
        style: style,
        onEachFeature: onEachFeature
    }).addTo(map);

    //map.attributionControl.addAttribution('Population data &copy; <a href="http://census.gov/">US Census Bureau</a>');




    //Functionality to add a legend to the map which is linked to the mapbox overlay however this may need to be changed at a later date
    var legend = L.control({position: 'bottomright'});

    legend.onAdd = function (map) {

        var div = L.DomUtil.create('div', 'info legend'),
            grades = [0, 10, 20, 50, 100, 200, 500, 1000],
            labels = [],
            from, to;

        for (var i = 0; i < grades.length; i++) {
            from = grades[i];
            to = grades[i + 1];

            labels.push(
                '<i style="background:' + getColor(from + 1) + '"></i> ' +
                from + (to ? '&ndash;' + to : '+'));
        }

        div.innerHTML = labels.join('<br>');
        return div;
    };

    legend.addTo(map);
*/




    //add geolocation
var options = {
  enableHighAccuracy: true,
  timeout: 5000,
  maximumAge: 0
};


//     // e.heading will contain the user's heading (in degrees) if it's available, and if not it will be NaN. This would allow you to point a marker in the same direction the user is pointed. 
//     L.marker(position.coords.latitude +","+ position.coords.longitude).addTo(map);
// });
/*
var baseLayers = {
    "Mapbox": mapbox,
    "OpenStreetMap": osm
};
var overlays = {
    "Marker": marker,
    "Roads": roadsLayer
};

*/



    </script>     



</body>
</html>

