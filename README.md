# common-ground_map

An enhanced leaflet map made for re-use (highly commented, built openly) used to show community groups and find "common ground"

This may uses data sets generated by the Mapping Community project, which are stored on [https://zenodo.org/communities/mapping-community](the Zenodo repository) and hosted live at [https://carto.mapping.community].

## To view as a local copy (development mode):

1. Start by downloading / cloning the repo.
2. Run the server: `node Clustering/server.js`
3. Open the following URL in a web browser: `http://localhost:8081/`

## To install (as a production service):

Note: we use Phusion Passenger on our web servers, which run Apache, but there are many other ways to run a web proxy. If you are using our install guide, you can use [https://www.phusionpassenger.com/library/walkthroughs/deploy/nodejs/ownserver/apache/oss/el7/deploy_app.html](the Phusion install guide), skipping steps 1.1 and 1.3.

1. Create a user account for the web application: `sudo adduser commonground`
2. Create directory for the repository: `sudo mkdir -p /opt/common-ground_map`
3. Set initial permissions: `sudo chown commonground: /opt/common-ground_map`
4. Pull code from GitHub: `cd /opt/common-ground_map`
5. `Sudo -u commonground -H git clone https://github.com/mapcomm/common-ground_map.git Code`
6. `sudo -u commonground -H bash -l`
7. Change to new directory: `cd /opt/common-ground_map/code`
8. Compile node packages: `sudo env "PATH=$PATH" npm install --production`
9. Exit back to main account: `exit`
10. Edit Apache config `sudo nano /etc/httpd/conf.d/commonground_map.conf` to include the following:

><VirtualHost *:80>
        ServerName commonground.mapping.community

        # Tell Apache and Passenger where your app's code directory is
        DocumentRoot /opt/common-ground_map/code/public
        PassengerAppRoot /opt/common-ground_map/code

        # Tell Passenger that your app is a Node.js app
        PassengerAppType node
        PassengerStartupFile Clustering/server.js

        # Relax Apache security settings
        <Directory /opt/common-ground_map/code/public>
        Allow from all
        Options -MultiViews
        # Uncomment this if you're on Apache >= 2.4:
        #Require all granted
        </Directory>
    </VirtualHost>

11. Restart Apache: ``
